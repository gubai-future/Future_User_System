# 未来用户聊天系统(未完成)

## 项目背景

聊天系统

## 技术选型

#### 后端

- java 11

- pring boot 2.6.13
- mybatisPlus 3.5.5
- swagger +knife4j 2.0.9 
- spring mvc
- redis
- mysql





## 用户表

> id bigint auto_increment primary key 编号
>
> user_account varchar(255) not null 账户
>
> user_password varchar(255) not null 密码 *加密*
>
> user_name varchar(255) not null 用户名
>
> user_sex tinyint default 2 性别 0-男 1-女 2-未知
>
> user_age tinyint null 年龄
>
> email varchar(255) null 邮箱
>
> phone varchar(255) null 手机号
>
> id_delete tinyint default 0 是否删除 0-未删除 1-删除
>
> user_role tinyint default 0 用户身份 0-普通用户 1-会员 2-管理员 
>
> 3-超级管理员(唯一)
>
> user_avatar varchar(1024) null 用户头像
>
> user_tags varchar(1024) null 用户标签
>
> create_time datetime default CURRENT_TIMESTAMP  null 创建时间
>
> update_time datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP 修改时间

## 返回响应体格式

> code:状态码
>
> msg:响应体信息
>
> data:响应数据
>
> description:详情

## 用户相关接口

### 注册  /user/register

> 校验输入数据是否为空
>
> 邮箱和手机号非空
>
> 账户长度为 7 ~ 15 位数字，密码 8 ~ 15 位(必须至少含有大小写英文一位。特殊字符一位)
>
> 用户名 4 到 16 个字符，可以包含字母、数字和下划线
>
> 密码和校验密码是否一致
>
> 加密密码
>
> 账户自动生成登录

### 登录  /user/login

> 校验数据是否为空
>
> 账户密码校验
>
> 账户校验
>
> 密码校验
>
> 账户是否存在
>
> 加密密码
>
> 查询数据库
>
> 是否被封禁
>
> 用户脱敏
>
> 存储session ==> cookei
>
> 返回用户脱敏数据

### 当前用户 /user/current

> 判断 cookie 中是否存储用户
>
> 如果不存在报未登录异常
>
> 如果存在返回当前用户

### 是否是管理员

> 判断传入用户是否为空
>
> 判断否为管理员
>
> 如果是返回true
>
> 如果不是返回false

### 删除用户 /user/delete

> 请求数据是否为空
>
> 删除的用户是否存
>
> 是否是当前用户或管理员
>
> 超级管理员不可以删除
>
> 管理员可以删除其他普通用户
>
> 普通管理员不可以删除其他管理员
>
> 超级管理员可以删除普通管理员
>
> 操作数据库

### 修改用户 /user/update

> 请求数据是否为空
>
> 超级管理员不可修改
>
> 修改的用户是否存在
>
> 判断修改人是当前用户还是管理员
>
> 普通管理员可以修改用户但不可以修改其他管理员
>
> 超级管理员可以修改所有成员
>
> 权限不可以修改
>
> 密码不可以修改
>
> 执行修改

### 修改密码  /user/update/pad

> 请求数据是否为空
>
> 判断是否登录
>
> 用户是否存在
>
> 登录对象是管理还是当前用户
>
> 旧密码判断
>
> 超级管理员可以不要旧密码
>
> 新密码校验
>
> 确认密码与新密码一致
>
> 加密新密码
>
> 修改密码

### 修改用户身份  /user/set/role

> 请求数据是否为空
>
> 判断是不是管理员
>
> 修改对象是否存在
>
> 修改对象的身份
>
> 管理员自己不可以修改自己
>
> 如果修改的权限一样直接返回
>
> 超级管理员可以指定:普通用户，会员，管理员
>
> 管理员可以指定用户:普通用户，会员

### 根据名字查询用户 /user/query/name

>传入参数不能为空
>
>传入参数不能是空字符串

### 根据标签查询用户  /user/query/tags

>传入标签不为空
>
>如果传入的标签数大于5  查询除去用户标签为空的全部用户 将用户的标签序列化通过optional对象返回存在传入标签的用户
>
>如果不大于5直接查询数据库



### 管理员查看用户 

>

### 封禁用户(管理员)

>传入的用户id不能为空
>
>不是管理员不可以操作
>
>用户是否存在
>
>不能封禁自己
>
>管理员不能封禁管理员
>
>管理员不能封禁超级管理员
>
>超级管理员可以封禁普通管理员



## 群聊相关接口

### 创建群聊 /rank/add

请求参数不能为空

判断创建人的状态是否正常

判断群聊名是否已存在

群聊名正则校验

一个人最多在哪创建5个群聊

如果是普通用户最大人数只能是30如果是会员则为120人

设置创始人、群主、创始人数 1 人

插入

如果插入失败抛异常

根据名字查询数据库如果有2条则说明名字重复抛异常回滚

设置用户群聊关系字段

插入数据库后判断是否插入成功，如果没有抛异常

然后布尔值







