# 趣聊(未完成)

## 项目背景

聊天系统

## 技术选型

#### 后端

- java 11

- pring boot 2.6.13
- mybatisPlus 3.5.5
- swagger +knife4j 2.0.9 
- spring mvc
- redis
- mysql
- websocket





## 用户表

> id bigint auto_increment primary key 编号
>
> user_account varchar(255) not null 账户
>
> user_password varchar(255) not null 密码 *加密*
>
> user_name varchar(255) not null 用户名
>
> user_sex tinyint default 2 性别 0-男 1-女 2-未知
>
> user_age tinyint null 年龄
>
> email varchar(255) null 邮箱
>
> phone varchar(255) null 手机号
>
> id_delete tinyint default 0 是否删除 0-未删除 1-删除
>
> user_role tinyint default 0 用户身份 0-普通用户 1-会员 2-管理员 
>
> 3-超级管理员(唯一)
>
> user_avatar varchar(1024) null 用户头像
>
> user_tags varchar(1024) null 用户标签
>
> create_time datetime default CURRENT_TIMESTAMP  null 创建时间
>
> update_time datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP 修改时间

## 返回响应体格式

> code:状态码
>
> msg:响应体信息
>
> data:响应数据
>
> description:详情

## 用户相关接口

### 注册  /user/register

> 校验输入数据是否为空
>
> 邮箱和手机号非空
>
> 校验邮箱验证码
>
> 校验手机号
>
> 账户长度为 7 ~ 15 位数字，密码 8 ~ 15 位(必须至少含有大小写英文一位。特殊字符一位)
>
> 用户名 4 到 16 个字符，可以包含字母、数字和下划线
>
> 密码和校验密码是否一致
>
> 加密密码
>
> 账户自动生成登录

### 登录  /user/login

> 校验数据是否为空
>
> 账户密码校验
>
> 账户校验
>
> 密码校验
>
> 账户是否存在
>
> 加密密码
>
> 查询数据库
>
> 是否被封禁
>
> 用户脱敏
>
> 存储session ==> cookei
>
> 返回用户脱敏数据

### 当前用户 /user/current

> 判断 cookie 中是否存储用户
>
> 如果不存在报未登录异常
>
> 如果存在返回当前用户

### 是否是管理员

> 判断传入用户是否为空
>
> 判断否为管理员
>
> 如果是返回true
>
> 如果不是返回false

### 删除用户 /user/delete

> 请求数据是否为空
>
> 删除的用户是否存
>
> 是否是当前用户或管理员
>
> 超级管理员不可以删除
>
> 管理员可以删除其他普通用户
>
> 普通管理员不可以删除其他管理员
>
> 超级管理员可以删除普通管理员
>
> 操作数据库

### 修改用户 /user/update

> 请求数据是否为空
>
> 超级管理员不可修改
>
> 修改的用户是否存在
>
> 判断修改人是当前用户还是管理员
>
> 普通管理员可以修改用户但不可以修改其他管理员
>
> 超级管理员可以修改所有成员
>
> 权限不可以修改
>
> 密码不可以修改
>
> 执行修改

### 修改密码  /user/update/pad

> 请求数据是否为空
>
> 判断是否登录
>
> 用户是否存在
>
> 登录对象是管理还是当前用户
>
> 旧密码判断
>
> 超级管理员可以不要旧密码
>
> 新密码校验
>
> 确认密码与新密码一致
>
> 加密新密码
>
> 修改密码

### 修改用户身份  /user/set/role

> 请求数据是否为空
>
> 判断是不是管理员
>
> 修改对象是否存在
>
> 修改对象的身份
>
> 管理员自己不可以修改自己
>
> 如果修改的权限一样直接返回
>
> 超级管理员可以指定:普通用户，会员，管理员
>
> 管理员可以指定用户:普通用户，会员

### 根据名字查询用户 /user/query/name

>传入参数不能为空
>
>传入参数不能是空字符串

### 根据标签查询用户  /user/query/tags

>传入标签不为空
>
>如果传入的标签数大于5  查询除去用户标签为空的全部用户 将用户的标签序列化通过optional对象返回存在传入标签的用户
>
>如果不大于5直接查询数据库



### 管理员查看用户 

>

### 封禁用户(管理员)

>传入的用户id不能为空
>
>不是管理员不可以操作
>
>用户是否存在
>
>不能封禁自己
>
>管理员不能封禁管理员
>
>管理员不能封禁超级管理员
>
>超级管理员可以封禁普通管理员

## 联系人分组

>id 分组id
>
>name 分组名字

### 创建分组（系统管理员）

>数据不能为空
>
>分组名是否存在
>
>写入数据库

### 删除分组 （系统管理员）

>数据不能为空
>
>根据id删除分组

### 查询分组（系统管理员）

>根据条件查询分组

### 修改分组

>根据id修改分组名字

## 联系人

>id 
>
>userId 用户id
>
>friendId 联系人id
>
>remarks 备注
>
>friendIdentity 用户身份
>
>groupingId 分组id 

### 新增联系人

>参数不能为空
>
>新增的用户是否存在
>
>新增的用户状态是否正常
>
>新增用户是否意见是联系人了
>
>联系人审核是否存在，如果返回请求失败并提示请等待联系人同意
>
>写入联系人审核

### 修改联系人身份或者分组或者备注

>请求数据不能为空
>
>修改的数据是否存在
>
>如果身份、分组、备注都为空报错
>
>修改对象是否为登录用户联系人

### 查询当前用户所有联系人

>

### 根据 id 查询联系人

>请求参数不能为空

### 删除联系人

>
>
>

## 联系人审核

>id
>
>userId 用户id
>
>applicationId 申请人
>
>status 申请状态 0-待审核 1-同意 2-不同意

### 新增联系人审核

>只有在新增用户的时候新增

### 处理联系人审核

>参数不能为空
>
>
>
>



## 群聊相关接口

### 创建群聊 /GroupChat/add

> 请求参数不能为空
>
> 判断创建人的状态是否正常
>
> 判断群聊名是否已存在
>
> 群聊名正则校验
>
> 一个人最多在哪创建5个群聊
>
> 如果是普通用户最大人数只能是30如果是会员则为120人
>
> 设置创始人、群主、创始人数 1 人
>
> 插入
>
> 如果插入失败抛异常
>
> 根据名字查询数据库如果有2条则说明名字重复抛异常回滚
>
> 设置用户群聊关系字段
>
> 插入数据库后判断是否插入成功，如果没有抛异常
>
> 返回布尔值

### 修改群聊 /GroupChat/update

> 参数非空判断
>
> 修改的群聊是否存在
>
> 修改对象是否在群里
>
> 群管理员或群主可修改
>
> 只能修改群聊名称，群聊简介，加入状态(是否需要管理员同意)
>
> 如果修改了群聊名称则需要正则校验
>
> 扩展：一个月可以修改一次群聊名字

### 加入群聊 /GroupChat/join

>请求参数不能为空 
>
>群聊是否存在
>
>群聊状态是否正常
>
>用户是否已经存在该群聊
>
>群聊人数是否正常
>
>查看群聊加入状态
>
>如果为公开执行
>
>​	写入数据库时群聊当前人数 +1
>
>​	写入用户群聊关系表
>
>如果不为公开执行
>
>​	写入群聊审核表

### 新增群聊审核 /GroupChat/add/examine

>请求参数不能为空
>
>群聊是否还存在
>
>群聊状态是否正常
>
>申请人是否存在
>
>申请人是否已经在群聊
>
>申请人状态是否正常
>
>审核留言最多150 字
>
>是否已经在审核中
>
>​	如果存在返回该条审核
>
>新增群聊审核

### 审核群聊加入用户 /GroupChat/examine

> 请求参数不能为空
>
> 审核数据是否存在
>
> 审核状态是否为未审核
>
> 审核人状态是否正常
>
> 审核人是否为本群管理员或群主
>
> 审核人在群里是否被封禁
>
> 如果待审核时间超过2天则已过时，修改状态，返回已过时信息
>
> 如果审核结果为不同意，修改状态，返回不同意信息
>
> 如果为同意则修改状态，加入队伍

### 群主解散群聊 

>请求参数不能为空
>
>该群聊是否存在
>
>登录用户是否为该群聊的群主

### 退出群聊  /GroupChat/quit

>请求参数不能为空
>
>群聊是否存在
>
>用户是否存在
>
>如果是最后一人删除群聊
>
>用户的是否是不是群主如果是则转让群主(群主从管理员中选择加入时间早的用户)
>
>

### 查看群聊(根据名字) /GroupChat/query/name

>请求参数不能为空
>
>根据名字模糊查询

### 查看群聊（管理员） /GroupChat /admin/query

>判断是否为管理员
>
>参数为空查询全部
>
>根据条件查询群聊
>
>群聊id、群聊名字等具体查看接口文档

### 设置群聊用户名字  /GroupChat/install/name

>请求参数不能为空
>
>群聊是否存在
>
>用户是否存在群聊
>
>如果存在可以修改不存在报错

### 设置用户群聊身份  /GroupChat/install/authority

>请求参数不能为空
>
>群聊是否存在
>
>用户是否在该群聊
>
>用户是否已经是该身份了
>
>只能由群主设置
>
>修改对象不能是群主自己

### 禁言 

>请求参数不能为空
>
>群聊是否存在
>
>用户是否为该群聊管理员或者群主
>
>禁用对象是否存在
>
>该对象是否是否已被禁言
>
>禁言该对象

### 踢出群聊 

>请求参数不能为空
>
>群聊是否存在
>
>踢出对象是否在
>
>操作用户是否为该群聊管理员

## 群聊聊天





## 消息缓存

### 返回指定用户的消息缓存（私聊，登录用户与联系人）-当天

>需要登录
>
>指定的联系人id不能为空
>
>从redis中查询

### 返回指定用户的消息缓存-指定日期 

>指定的用户id不能为空
>
>返回开始日期和结束日期的指定用户消息

### 返回指定群聊的消息缓存-当天 TODO

>指定群聊id不能为空
>
>从redis中查询

### 返回指定群聊的消息缓存-当天 TODO

>指定群聊id不能为空
>
>返回开始日期和结束日期的指定群聊消息

### 查询指定用户全部消息缓存(平台管理员) TODO

>登录用户必须是平台管理员才能访问
>
>指定的两用户id不能为空

### 查询指定群聊消息缓存 (平台管理员)TODO

>登录用户必须是平台管理员才能访问
>
>查询的群聊id不能为空

## 邮箱登录 TODO

>请求参数不能为空
>
>邮箱格式需要正常
>
>当前邮箱是否绑定用户
>
>密码加密
>
>校验密码
>
>用户状态是否正常

### 邮箱验证码发送

>请求参数不能为空

## 手机号登录 TODO

>

## 金额相关 TODO

>

## 积分 TODO
